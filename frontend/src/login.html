<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>ƒêƒÉng nh·∫≠p - Delivery System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --pri:#2563eb; --bg:#f8fafc; --bd:#e2e8f0; --text:#0f172a; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:system-ui,Arial}
    .wrap{min-height:100dvh;display:grid;place-items:center;padding:24px}
    .card{width:100%;max-width:420px;background:#fff;border:1px solid var(--bd);border-radius:16px;padding:24px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    h1{margin:0 0 8px;font-size:22px;color:var(--text)}
    p.note{margin:0 0 20px;color:#475569;font-size:14px}
    label{display:block;font-size:14px;color:#334155;margin:12px 0 6px}
    input,select{width:100%;padding:10px 12px;border:1px solid var(--bd);border-radius:10px;font-size:14px}
    .row{display:flex;gap:10px;align-items:center}
    .hint{font-size:12px;color:#64748b;margin-top:6px}
    .btn{width:100%;margin-top:14px;padding:12px;border:none;border-radius:12px;background:var(--pri);color:#fff;font-weight:600;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .alt{display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-size:14px}
    .link{color:var(--pri);text-decoration:none}
    .err{margin-top:10px;padding:10px;border-radius:10px;background:#fef2f2;color:#991b1b;border:1px solid #fecaca;display:none}
    .ok{margin-top:10px;padding:10px;border-radius:10px;background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <form class="card" id="loginForm" novalidate>
      <h1>ƒêƒÉng nh·∫≠p</h1>
      <p class="note">V√†o h·ªá th·ªëng giao nh·∫≠n h√†ng.</p>

      <label for="email">Email</label>
      <input id="email" name="email" type="email" placeholder="you@example.com" required />

      <label for="password">M·∫≠t kh·∫©u</label>
      <div class="row">
        <input id="password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
        <label class="row" style="gap:6px;font-size:12px;white-space:nowrap;">
          <input type="checkbox" id="togglePwd"/> Hi·ªán
        </label>
      </div>

      <label for="role">Vai tr√≤</label>
      <select id="role" name="role">
        <option value="customer">Kh√°ch h√†ng</option>
        <option value="driver">T√†i x·∫ø</option>
        <option value="admin">Qu·∫£n tr·ªã</option>
      </select>
      <div class="hint">Vai tr√≤ ƒë∆∞·ª£c d√πng ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng UI ph√π h·ª£p sau khi ƒëƒÉng nh·∫≠p.</div>

      <button class="btn" id="submitBtn">ƒêƒÉng nh·∫≠p</button>
      <div class="err" id="errBox"></div>
      <div class="ok" id="okBox"></div>

      <div class="alt">
        <span>Ch∆∞a c√≥ t√†i kho·∫£n?</span>
        <a class="link" href="register.html">ƒêƒÉng k√Ω</a>
      </div>
    </form>
  </div>

  <script>
    const f = document.getElementById('loginForm');
    const errBox = document.getElementById('errBox');
    const okBox = document.getElementById('okBox');
    const pwd = document.getElementById('password');
    document.getElementById('togglePwd').addEventListener('change', (e)=> {
      pwd.type = e.target.checked ? 'text' : 'password';
    });

    f.addEventListener('submit', async (e) => {
      e.preventDefault();
      errBox.style.display = 'none'; okBox.style.display = 'none';

      const email = f.email.value.trim();
      const password = f.password.value;
      const role = f.role.value;

      if(!email || !password){
        errBox.textContent = 'Vui l√≤ng nh·∫≠p email v√† m·∫≠t kh·∫©u.'; errBox.style.display='block'; return;
      }

      try {
        // üëâ ƒê·ªîI URL n√†y th√†nh API th·∫≠t c·ªßa b·∫°n (backend)
        const res = await fetch('http://localhost:3000/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({ email, password, role })
        });

        if(!res.ok){
          const msg = await res.text();
          throw new Error(msg || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i');
        }

        const data = await res.json();
        // V√≠ d·ª•: l∆∞u token r·ªìi ƒëi·ªÅu h∆∞·ªõng
        localStorage.setItem('token', data.token);
        okBox.textContent = 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng! ƒêang chuy·ªÉn trang...';
        okBox.style.display = 'block';
        setTimeout(()=> {
          // ƒëi·ªÅu h∆∞·ªõng theo role
          if(role==='admin') location.href = '/admin.html';
          else if(role==='driver') location.href = '/driver.html';
          else location.href = '/dashboard.html';
        }, 700);
      } catch (err) {
        errBox.textContent = err.message || 'C√≥ l·ªói x·∫£y ra.';
        errBox.style.display = 'block';
      }
    });
  </script>
</body>
</html>
